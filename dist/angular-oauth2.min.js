!function(e,t){"function"==typeof define&&define.amd?define(["angular","query-string"],t):"object"==typeof exports?module.exports=t(require("angular"),require("query-string")):e.angularOAuth2=t(e.angular,e.queryString)}(this,function(e,t){function r(e){e.interceptors.push("oauthInterceptor")}function n(e,t,r){return{request:function(e){return r.getAuthorizationHeader()&&(e.headers=e.headers||{},e.headers.Authorization=r.getAuthorizationHeader()),e},responseError:function(n){return 400!==n.status||!n.data||"invalid_request"!==n.data.error&&"invalid_grant"!==n.data.error||(r.removeToken(),t.$emit("oauth:error",n)),(401===n.status&&n.data&&"invalid_token"===n.data.error||n.headers("www-authenticate")&&0===n.headers("www-authenticate").indexOf("Bearer"))&&t.$emit("oauth:error",n),e.reject(n)}}}function o(){var t;this.configure=function(r){if(t)throw new Error("Already configured.");if(!(r instanceof Object))throw new TypeError("Invalid argument: `config` must be an `Object`.");return t=e.extend({},c,r),e.forEach(s,function(e){if(!t[e])throw new Error("Missing parameter: "+e+".")}),"/"===t.baseUrl.substr(-1)&&(t.baseUrl=t.baseUrl.slice(0,-1)),"/"!==t.grantPath[0]&&(t.grantPath="/"+t.grantPath),"/"!==t.revokePath[0]&&(t.revokePath="/"+t.revokePath),t},this.$get=function(r,n){var o=function(){function o(){if(!t)throw new Error("`OAuthProvider` must be configured first.")}return u(o,null,{isAuthenticated:{value:function(){return!!n.getToken()},writable:!0,enumerable:!0,configurable:!0},getAccessToken:{value:function(o,a){if(!o||!o.username||!o.password)throw new Error("`user` must be an object with `username` and `password` properties.");var i={client_id:t.clientId,grant_type:"password",username:o.username,password:o.password};return null!==t.clientSecret&&(i.client_secret=t.clientSecret),a=e.extend({params:i,headers:{"Content-Type":"application/x-www-form-urlencoded"}},a),r.get(""+t.baseUrl+t.grantPath,a).then(function(e){return n.setToken(e.data),e})},writable:!0,enumerable:!0,configurable:!0},getRefreshToken:{value:function(){var e={client_id:t.clientId,grant_type:"refresh_token",refresh_token:n.getRefreshToken()};null!==t.clientSecret&&(e.client_secret=t.clientSecret);var o={params:e,headers:{"Content-Type":"application/x-www-form-urlencoded"}};return r.post(""+t.baseUrl+t.grantPath,o).then(function(e){return n.setToken(e.data),e})},writable:!0,enumerable:!0,configurable:!0},revokeToken:{value:function(){var e={token:n.getRefreshToken()?n.getRefreshToken():n.getAccessToken()},o={params:e,headers:{"Content-Type":"application/x-www-form-urlencoded"}};return r.post(""+t.baseUrl+t.revokePath,o).then(function(e){return n.removeToken(),e})},writable:!0,enumerable:!0,configurable:!0}}),o}();return new o},this.$get.$inject=["$http","OAuthToken"]}function a(){var t={name:"token",options:{secure:!0}};this.configure=function(r){if(!(r instanceof Object))throw new TypeError("Invalid argument: `config` must be an `Object`.");return e.extend(t,r),t},this.$get=function(e){var r=function(){function r(){}return u(r,null,{setToken:{value:function(r){e[t.name]=r},writable:!0,enumerable:!0,configurable:!0},getToken:{value:function(){return e[t.name]},writable:!0,enumerable:!0,configurable:!0},getAccessToken:{value:function(){return this.getToken()?this.getToken().access_token:void 0},writable:!0,enumerable:!0,configurable:!0},getAuthorizationHeader:{value:function(){return this.getTokenType()&&this.getAccessToken()?""+(this.getTokenType().charAt(0).toUpperCase()+this.getTokenType().substr(1))+" "+this.getAccessToken():void 0},writable:!0,enumerable:!0,configurable:!0},getRefreshToken:{value:function(){return this.getToken()?this.getToken().refresh_token:void 0},writable:!0,enumerable:!0,configurable:!0},getTokenType:{value:function(){return this.getToken()?this.getToken().token_type:void 0},writable:!0,enumerable:!0,configurable:!0},removeToken:{value:function(){delete e[t.name]},writable:!0,enumerable:!0,configurable:!0}}),r}();return new r},this.$get.$inject=["$sessionStorage"]}var i=e.module("angular-oauth2",["ngStorage"]).config(r).factory("oauthInterceptor",n).provider("OAuth",o).provider("OAuthToken",a);r.$inject=["$httpProvider"],n.$inject=["$q","$rootScope","OAuthToken"];var u=function(e,t,r){t&&Object.defineProperties(e,t),r&&Object.defineProperties(e.prototype,r)},c={baseUrl:null,clientId:null,clientSecret:null,grantPath:"/oauth2/token",revokePath:"/oauth2/revoke"},s=["baseUrl","clientId","grantPath","revokePath"],u=function(e,t,r){t&&Object.defineProperties(e,t),r&&Object.defineProperties(e.prototype,r)};return i});